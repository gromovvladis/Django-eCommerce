{% extends "oscar/layout.html" %}

{% load currency_filters %}
{% load image_tags %}
{% load purchase_info_tags %}
{% load svg_tags %}
{% load compress %}
{% load static %}

{% block title %}Заказ №{{ order.number }} | {{ block.super }}{% endblock %}
{% block nav_title %}Заказ №{{ order.number }}{% endblock %}
{% block nav_title_center %}Заказ №{{ order.number }}{% endblock %}
{% block wrapper_class %}checkout fill-width pd-2 pb-sm-4 pt-sm-2 checkout__container{% endblock %}
{% block app_class %}v-app---thank{% endblock %}
{% block nav_class %}v-app__nav--thank{% endblock %}

{% block breadcrumbs %}
    <div aria-label="breadcrumb" class="v-bread d-none d-sm-flex align-center my-2">
        <button onclick="window.location.href='{{ homepage_url }}'" data-id="back-bread-btn" class="pd-0 mr-1">
            {% icon file_name='interface/arrow-back' size=22 stroke="#111"%}
        </button>
        <a href="{{ homepage_url }}" data-id="back-bread-btn" class="v-bread__link router-link-active">Главная</a>
        {% icon file_name='interface/arrow-left' size=24 stroke='#999'%}
        <span class="v-bread__link" aria-current="page">Заказ №{{ order.number }}</span>
    </div>
{% endblock %}

{% block content %}
    <div class="d-flex flex-column mt-md-4">
        <div class="v-order d-flex flex-column flex-md-row align-md-start">
            <div class="v-order__wrapper  d-flex flex-column">
                <div class="v-order__info-wrapper d-flex flex-column fill-width">
                    <div class="v-order__title d-flex mb-4 justify-start align-center">
                        <svg class="mr-2" data-id="payment-icon-svg" width="30" height="30">
                            {% if order.status == "Ожидает оплаты" %}
                                <use xlink:href="#svg-order-pending"></use>
                            {% elif order.status == "Отменен" %}
                                <use xlink:href="#svg-order-cancel"></use>
                            {% else %}
                                <use xlink:href="#svg-order-success"></use>
                            {% endif %}
                        </svg>
                        <h1> Заказ оформлен! </h1>
                    </div>

                    {% block shipping_info %}
                        <div class="v-checkout__datail pb-2">
                            {% if order.shipping_address %}
    
                                <div class="v-order__subtitle mb-1 mb-sm-2">
                                    <h2>Адрес доставки</h2>
                                </div>
    
                                <address class="v-checkout__detail-text mb-2">
                                    {% for field in order.shipping_address.active_address_fields_and_labels %}
                                        {{ field.label }}: {{ field.value }}{% if not forloop.last %},{% endif %}
                                        <br>
                                    {% endfor %}
                                </address>
    
                                {% if order.shipping_address.notes %}
                                    <div class="v-checkout__detail-text mb-1">
                                        <span>Инструкции курьеру: </span>
                                        <span>{{ order.shipping_address.notes }}</span>
                                    </div>
                                {% endif %}

                                {% with order_note=order.client_note %}
                                    {% if order_note %}
                                        <div class="v-checkout__detail-text mb-2">
                                            <span>Коментарий к заказу: </span>
                                            <span>{{ order_note }}</span>
                                        </div>
                                    {% endif %}
                                {% endwith %}

                            {% else %}
                                <div class="v-order__subtitle mb-1 mb-sm-2">
                                    <h2>Адрес самовывоза</h2>
                                </div>
                                <a href="{% url 'address:pickup-address' %}" class="v-checkout__detail-text mb-2">
                                    <address> Красноясрк, ул. 9 Мая 77,
                                        <br>
                                        ТРЦ "Планета" Фудкорд Mikado
                                    </address>
                                </a>
                            {% endif %}
                        </div>
                        <div class="v-checkout__datail">
                            <div class="v-order__subtitle mb-1 mb-sm-2">
                                <h2>Телефон для связи</h2>
                            </div>

                            <div class="mb-2 v-checkout__detail-text">
                                <p>{{ request.user.username }}</p>
                            </div>
                        </div>
                    {% endblock %}

                    {% block payment_info %}

                        <div class="v-order__subtitle mb-1 mb-sm-2">
                            <h2>Оплата</h2>
                        </div>

                        {% for source in order.sources.all %}
                            <div class="v-checkout__detail-text mr-2">
                                <span>Способ оплаты: </span>
                                <span>{{ source.source_type.name }}</span>
                            </div>    
                            <div class="v-checkout__detail-text mr-2">
                                <span>Сумма: </span>
                                <span>{{ source.amount_allocated|currency:source.currency }}</span>
                            </div>    
                            
                            <div class="v-checkout__detail-text mr-2">
                                <span >Статус заказа: </span>
                                <strong><span class="text--info" data-id="payment-status">{{ order.status }}</span></strong>
                            </div> 
                            
                        {% endfor %}
                    {% endblock %}
                </div>
            </div>

            <div class="v-order__info ml-md-4">
                <div class="v-order__info-wrapper pt-4">
            
                    <p class="v-order__title d-none d-md-block mb-4"> Ваш заказ </p>
            
                    <div class="v-order__subtitle d-md-none mb-1 mb-sm-2">
                        <h2>Ваш заказ</h2>
                    </div>
                    
                    <div class="v-order__subtitle mb-1 mb-sm-1 d-none d-md-block">
                        <h2>Состав заказа</h2>
                    </div>

                    {% comment %} состав заказа {% endcomment %}
                    {% block order_contents %}
                        <div class="v-order-checkout__items">
                            {% for line in order.basket.all_lines %}
                                {% purchase_info_for_line request line as session %}
                                    <span>{{ line.product.get_title }} ({{ line.quantity }} шт.){% if not forloop.last %},{% endif %}</span>
                            {% endfor %}
                        </div>
                    {% endblock order_contents %}
            
                    {% comment %} totals {% endcomment %}
                    <div id="checkout_totals">
                        {% include 'oscar/customer/order/order_totals.html' %}
                    </div>

                </div>
            </div>  
        </div>
    </div>

    {% if order.status == "Ожидает оплаты" %}
        {% include "oscar/checkout/partials/payment_waiting.html" %}
    {% endif %}
            
{% endblock content %}

{% block tracking %}
    {% if send_analytics_event %}
        {% include "oscar/partials/google_analytics_transaction.html" %}
    {% endif %}
{% endblock %}

{% block SVG %}
    <svg style="display: none">
        <symbol id="svg-order-cancel" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path fill="#b24040" d="M23,12A11,11,0,0,1,1,12a10.827,10.827,0,0,1,.29-2.5,11,11,0,0,1,21.42,0A10.827,10.827,0,0,1,23,12Z"/>
            <ellipse fill="#ce5959" cx="12" cy="9.5" rx="10.71" ry="8.5"/>
            <path fill="#6c2e7c" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm0,22A10,10,0,1,1,22,12,10.011,10.011,0,0,1,12,22Z"/>
            <path fill="#6c2e7c" d="M16.707,7.293a1,1,0,0,0-1.414,0L12,10.586,8.707,7.293A1,1,0,1,0,7.293,8.707L10.586,12,7.293,15.293a1,1,0,1,0,1.414,1.414L12,13.414l3.293,3.293a1,1,0,0,0,1.414-1.414L13.414,12l3.293-3.293A1,1,0,0,0,16.707,7.293Z"/>
        </symbol>
        <symbol id="svg-order-pending" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path fill="#e1ca00" d="M23,12A11,11,0,0,1,1,12a10.827,10.827,0,0,1,.29-2.5,11,11,0,0,1,21.42,0A10.827,10.827,0,0,1,23,12Z"/>
            <ellipse fill="#fe0" cx="12" cy="9.5" rx="10.71" ry="8.5"/>
            <path fill="#cffeff" d="M15,16a1,1,0,0,1-.707-.293l-3-3A1,1,0,0,1,11,12V6a1,1,0,0,1,2,0v5.586l2.707,2.707A1,1,0,0,1,15,16Z"/>
            <path fill="#6c2e7c" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm0,22A10,10,0,1,1,22,12,10.011,10.011,0,0,1,12,22Z"/>
            <path fill="#6c2e7c" d="M13,11.586V6a1,1,0,0,0-2,0v6a1,1,0,0,0,.293.707l3,3a1,1,0,0,0,1.414-1.414Z"/>
        </symbol>
        <symbol id="svg-order-success" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path fill="#56b54e" d="M23,12A11,11,0,0,1,1,12a10.827,10.827,0,0,1,.29-2.5,11,11,0,0,1,21.42,0A10.827,10.827,0,0,1,23,12Z"/>
            <ellipse fill="#60cc5a" cx="12" cy="9.5" rx="10.71" ry="8.5"/>
            <path fill="#6c2e7c" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm0,22A10,10,0,1,1,22,12,10.011,10.011,0,0,1,12,22Z"/>
            <path fill="#6c2e7c" d="M16.293,8.293,10,14.586,7.707,12.293a1,1,0,0,0-1.414,1.414l3,3a1,1,0,0,0,1.414,0l7-7a1,1,0,0,0-1.414-1.414Z"/>
        </symbol>
    </svg>
{% endblock %}

{% block templatescripts %}
    {{ block.super }}
    action_back = function(){window.location.href="{{ homepage_url }}"};
    var csrf_token = "{{ csrf_token }}";
    var update_payment_url = "{% url 'payment:update' pk=order.pk %}";
{% endblock %}

{% block extrascripts %}
    {{ block.super }}
    {% compress js %}
        <script src="{% static "js/frontend/thank-you/thank-you.js" %}"></script>
    {% endcompress %}
{% endblock %}
