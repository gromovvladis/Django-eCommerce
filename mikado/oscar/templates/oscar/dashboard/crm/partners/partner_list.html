{% extends 'oscar/dashboard/layout.html' %}
{% load render_table from django_tables2 %}

{% block title %}
    Точки продаж | {{ block.super }}
{% endblock %}

{% block breadcrumbs %}
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'dashboard:index' %}">Главная</a></li>
            <li class="breadcrumb-item active" aria-current="page">Точки продаж</li>
        </ol>
    </nav>
{% endblock %}

{% block header %}
    <div class="page-header d-flex justify-content-between">
        <h1>Точки продаж</h1>
        <div class="d-flex">
            <button type="submit" form="partner_list_form" name="update_all" value="True" data-loading-text="Обновление..." class="btn btn-success ml-3"><i class="fa-solid fa-arrows-rotate"></i>
                <span>
                    Обновить все
                </span>
            </button>
            <button type="submit" form="partner_list_form" name="delete_invalid" value="True" data-loading-text="Удаление..." class="btn btn-danger ml-3"><i class="fa-solid fa-trash"></i>
                <span>
                    Удалить некорректные
                </span>
            </button>
        </div>
    </div>
{% endblock header %}

{% block dashboard_content %}

    <ul class="nav nav-tabs mb-3 mb-lg-4 p-0 fill-width" role="tablist">
        <div class="half-wrapper">
            <div class="nav tabs-button d-flex fill">
                <div class="tabs-button__active-block" style="width: 50%; left: 0px;"><div class="fill-width fill-height"></div></div>
                <button role="button" class="tabs-button__button tabs-button__icon active" href="#tab_evotor" data-toggle="tab">
                    <div class="no-wrap">
                        <i class="fa-solid fa-tablet-screen-button"></i>
                        <span>
                            Эвотор
                        </span>
                    </div>
                </button>
                <button role="button" class="tabs-button__button tabs-button__icon" href="#tab_site" data-toggle="tab">
                    <div class="no-wrap">
                        <i class="fa-solid fa-globe"></i>
                        <span>
                            Сайт
                        </span>
                    </div>
                </button>
            </div>
        </div>
    </ul>
    
    <div class="tab-content">
        
        <div class="tab-pane fade show active mt-2" id="tab_evotor" role="tabpanel">
            <div class="table-wrapper mb-3">
                <div class="table-header d-flex justify-space-between half-wrapper" data-target="#evotor-body" 
                data-toggle="collapse" aria-controls="evotor-body" aria-expanded="false">
                    <h3>Эвотор</h3>
                    <i class="fa-solid fa-chevron-up" style="color: var(--primary);"></i>
                    <i class="fa-solid fa-chevron-down" style="color: var(--primary);"></i>
                </div>
                <table class="table table-striped table-bordered half-wrapper collapse" id="evotor-body">
                    <tr>
                        <td class="text-center">
                            <span class="text-success">
                                <i class="fa-solid fa-circle-check"></i> 
                            </span>
                        </td>
                        <td>Точка продажи кооректно перенесена из системы Эвотор на сайт</td>
                    </tr>
                    <tr>
                        <td class="text-center"> 
                            <span class="text-warning">
                                <i class="fa-solid fa-triangle-exclamation"></i>
                            </span>
                        </td> 
                        <td>Точка продажи требует обновления на сайте</td>
                    </tr>
                    <tr>
                        <td class="text-center"> 
                            <span class="text-danger">
                                <i class="fa-solid fa-circle-xmark"></i>
                            </span>
                        </td>
                        <td>Точка продажи не была добавлена на сайт</td>
                    </tr>
                </table> 
            </div>
            {% if tables.0 %}
                <form id="partner_list_form" method="post" class="mobile-table">
                    {% csrf_token %}
                    {% render_table tables.0 %}
                    <div class="table-wrapper mb-4 d-none" id="actions_lines">
                        <div class="table-header d-flex justify-space-between" data-target="#status-body" 
                        data-toggle="collapse" aria-controls="status-body" aria-expanded="false">
                            <h3><i class="fa-solid fa-list-check"></i>Обновить точки продаж</h3>
                            <i class="fa-solid fa-chevron-up" style="color: var(--primary);"></i>
                            <i class="fa-solid fa-chevron-down" style="color: var(--primary);"></i>
                        </div>
                        <div class="card card-body dropdown-list collapse" id="status-body">
                            <h2 class="mb-3">Обновить выбранные точки продаж</h2>
                            <div class="form-inline fill-width justify-space-between">
                                <div class="btn-form d-flex">
                                    <button type="submit" name="update_all" value="False" class="btn btn-primary" data-loading-text="Обновление...">
                                        Обновить
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            {% else %}
                <p class="py-2">Ничего не найдено</p>
            {% endif %}      
        </div>

        <div class="tab-pane fade mt-2" id="tab_site" role="tabpanel">
           
            <div class="table-wrapper mb-3">
                <div class="table-header d-flex justify-space-between half-wrapper" data-target="#evotor-body" 
                data-toggle="collapse" aria-controls="evotor-body" aria-expanded="false">
                    <h3>Сайт</h3>
                    <i class="fa-solid fa-chevron-up" style="color: var(--primary);"></i>
                    <i class="fa-solid fa-chevron-down" style="color: var(--primary);"></i>
                </div>
                <table class="table table-striped table-bordered half-wrapper collapse" id="evotor-body">
                    <tr>
                        <td class="text-center">
                            <span class="text-success">
                                <i class="fa-solid fa-circle-check"></i> 
                            </span>
                        </td>
                        <td>Точка продажи кооректно перенесена из системы Эвотор на сайт</td>
                        <td>{{ is_valid }}</td>
                    </tr>
                    <tr>
                        <td class="text-center"> 
                            <span class="text-warning">
                                <i class="fa-solid fa-triangle-exclamation"></i>
                            </span>
                        </td> 
                        <td>Точка продажи требует обновления на сайте</td>
                        <td>{{ not_is_valid }}</td>
                    </tr>
                    <tr>           
                        <td class="text-center"> 
                            <span class="text-danger">
                                <i class="fa-solid fa-circle-xmark"></i>
                            </span>
                        </td>
                        <td>Точка продажи имеет некооретный Evotor ID и должна быть удалена</td>
                        <td>{{ wrong_evotor_id }}</td>
                    </tr>
                </table> 
            </div>

            {% if tables.1 %}
                <form id="partner_list_form" method="post" class="mobile-table">
                    {% csrf_token %}
                    {% render_table tables.1 %}
                    <div class="table-wrapper mb-4 d-none" id="actions_lines">
                        <div class="table-header d-flex justify-space-between" data-target="#status-body" 
                        data-toggle="collapse" aria-controls="status-body" aria-expanded="false">
                            <h3><i class="fa-solid fa-list-check"></i>Обновить точки продаж на сайте</h3>
                            <i class="fa-solid fa-chevron-up" style="color: var(--primary);"></i>
                            <i class="fa-solid fa-chevron-down" style="color: var(--primary);"></i>
                        </div>
                        <div class="card card-body dropdown-list collapse" id="status-body">
                            <h2 class="mb-3">Обновить выбранные точки продаж</h2>
                            <p class="mb-3">Данные точки продаж будет скопированы из системы Эвотор в базу данных сайта</p>
                            <div class="form-inline fill-width justify-space-between">
                                <div class="btn-form d-flex">
                                    <button type="submit" name="update_all" value="False" class="btn btn-primary" data-loading-text="Обновление...">
                                        Обновить
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            {% else %}
                <p class="py-2">Ничего не найдено</p>
            {% endif %}
        </div>
    </div>
    
{% endblock dashboard_content %}

{% block onbodyload %}
    {{ block.super }}
    oscar.dashboard.orders.initTable();
{% endblock onbodyload %}
