{% load basket_tags %}
{% load purchase_info_tags %}
{% load cache %}

{% purchase_info_for_product request product as session %}
{% if session.availability.is_available_to_buy and session.price.exists %}
    {% comment %}------------- вариации + доп опции ---------------{% endcomment %}
    <form id="add_to_basket_form" action="{% url 'basket:add' pk=product.pk  %}" method="post">
        {% csrf_token %}
        {% cache 1800 product_form product.id %}
            {% basket_form request product as basket_form %}
            {% if form.is_bound and not form.is_valid %}
                <div class="alert alert-danger">
                    <strong>Упс! Что-то пошло не так</strong> - пожалуйста, проверьте ошибки ниже и поторите снова
                </div>
            {% endif %}
            
            <div class="v-dish-actions fill-width d-flex flex-column">
                {% comment %}------------- вариации + поля опций---------------{% endcomment %}
                {% if product.is_parent %}
                    {% include "oscar/catalogue/partials/variants.html" with form=basket_form %}
                {% endif %}

                {% comment %}------------- поля опций ---------------{% endcomment %}
                {% if product.has_options %}
                    {% include "oscar/catalogue/partials/options.html" with form=basket_form %}
                {% endif %}

                {% comment %}------------- дополнительные ингридиенты ---------------{% endcomment %}
                {% if product.has_additions %}
                    {% include "oscar/catalogue/partials/additinal_products.html" with form=basket_form currency_symbol=currency_symbol %}
                {% endif %}
            </div>
        {% endcache %}
    </form>              
{% endif %}
