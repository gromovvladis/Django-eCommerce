{% extends 'oscar/layout.html' %}

{% load product_tags %}
{% load image_tags %}
{% load svg_tags %}
{% load compress %}
{% load static %}

{% block title %}
  {{ offer.name }} | {{ block.super }}
{% endblock %}
{% block nav_title_center %}
  {{ offer.name }}
{% endblock %}
{% block wrapper_class %}
  actions d-flex flex-column pd-2 pb-sm-4 container pd-0
{% endblock %}
{% block app_class %}
  app---action
{% endblock %}
{% block nav_class %}
  app__nav--action
{% endblock %}

{% block breadcrumbs %}
  <div aria-label="breadcrumb" class="bread d-none d-sm-flex align-center mt-2 mb-3">
    <button onclick="getBack(); return false" data-id="back-bread-btn" class="mr-1 pd-0">{% icon file_name='interface/arrow-back' size=22 stroke='#111' %}</button>
    <a href="{{ homepage_url }}" data-id="back-bread-btn" class="bread__link router-link-active">Главная</a>
    {% icon file_name='interface/arrow-left' size=24 stroke='#999' %}
    <a href="{% url 'home:actions' %}" data-id="back-bread-btn" class="bread__link router-link-active">Акции</a>
    {% icon file_name='interface/arrow-left' size=24 stroke='#999' %}
    <span class="bread__link" aria-current="page">{{ offer.name }}</span>
  </div>
{% endblock %}

{% block content %}
  <div class="action__wrapper d-flex flex-column">
    <div class="actions__action-detail-header d-flex flex-column align-start">
      <div class="actions__action-detail-banner shrink">
        <div class="image">
          <div class="image__inner image__inner--action">
            {% with image=offer.primary_image %}
              {% oscar_thumbnail image.original 'x450' upscale=False as thumb %}
              <img src="{{ thumb.url }}" alt="{{ offer.name }}" loading="lazy" class="img-thumbnail w-auto mx-auto my-0" />
            {% endwith %}
          </div>
        </div>
      </div>
    </div>
    <div class="actions__action-detail-content fill-width d-flex flex-column mt-2 mt-sm-4">
      <h1>{{ offer.name }}</h1>
      {% if offer.description %}
        <div class="actions__action-detail-text mt-2">
          <p>{{ offer.description|safe }}</p>
        </div>
      {% endif %}
      <div class="d-flex flex-column" id="action_message">
        {% if upsell_message %}
          <span class="fill-width mt-2 order-dialog__title">Условия акции:</span>
          <span class="fill-width mt-2 order-dialog__text">{{ upsell_message }}</span>
        {% endif %}
      </div>
    </div>
    {% if products %}
      <div class="dishes row fill-width mt-2 mt-sm-4">
        {% for product in products %}
          <div class="dishes--item col col-6 col-xs-6 col-sm-4 col-md-4 col-lg-3">
            {% render_product product %}
          </div>
        {% endfor %}
      </div>
    {% endif %}
    <div class="d-flex fill-width my-2 mt-sm-4">
      <a class="button button--main mt-md-0" href="{% url 'home:actions' %}">Смотреть все акции</a>
    </div>
  </div>
{% endblock %}

{% block templatescripts %}
  {{ block.super }}
  var url_action_message = "{% url 'offer:upsell' slug=offer.slug %}";
{% endblock %}

{% block extrascripts %}
  {{ block.super }}
  {% compress js %}
  <script src="{% static 'js/frontend/actions/action-message.js' %}" async></script>
  {% endcompress %}
{% endblock %}
