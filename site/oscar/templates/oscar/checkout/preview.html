{% extends 'oscar/layout.html' %}

{% load currency_filters %}
{% load purchase_info_tags %}
{% load image_tags %}
{% load svg_tags %}
{% load static %}

{% block title %}
  Заказ не оформлен | {{ block.super }}
{% endblock %}

{% block nav_title %}
  Заказ не оформлен
{% endblock %}
{% block nav_title_center %}
  Заказ не оформлен
{% endblock %}

{% block wrapper_class %}
  checkout fill-width pd-2 pb-sm-4 checkout__container
{% endblock %}

{% block app_class %}
  app---thank
{% endblock %}
{% block nav_class %}
  app__nav--thank
{% endblock %}

{% block breadcrumbs %}
  <div aria-label="breadcrumb" class="bread d-none d-sm-flex align-center my-2">
    <button onclick="window.location.href='{{ homepage_url }}'" data-id="back-bread-btn" class="pd-0 mr-1">{% icon file_name='interface/arrow-back' size=22 stroke='#111' %}</button>
    <a href="{{ homepage_url }}" data-id="back-bread-btn" class="bread__link router-link-active">Главная</a>
    {% icon file_name='interface/arrow-left' size=24 stroke='#999' %}
    <span class="bread__link" aria-current="page">Заказ не оформлен</span>
  </div>
{% endblock %}

{% block content %}
  <div class="d-flex flex-column mt-md-4">
    <div class="order d-flex flex-column flex-md-row align-md-start">
      <div class="order__wrapper d-flex flex-column">
        <div class="order__info-wrapper d-flex flex-column fill-width">
          <div class="order__title d-flex mb-1 justify-start align-center">
            <svg class="mr-2" data-id="payment-icon-svg" width="30" height="30">
              <use xlink:href="#svg-order-cancel"></use>
            </svg>
            <h1>Oшибка!</h1>
          </div>
          <span class="mb-3 info-message text--red">{{ error }}</span>
          {% block shipping_info %}
            <div class="checkout__datail pb-2">
              {% if shipping_address %}
                <div class="order__subtitle mb-1 mb-sm-2">
                  <h2>Адрес доставки</h2>
                </div>
                <address class="checkout__detail-text mb-2">
                  {% for field in shipping_address.active_address_fields_and_labels %}
                    {{ field.label }}: {{ field.value }}{% if not forloop.last %},{% endif %}
                    <br />
                  {% endfor %}
                </address>
                {% if shipping_address.notes %}
                  <div class="checkout__detail-text mb-1">
                    <span>Инструкции курьеру:</span>
                    <span>{{ shipping_address.notes }}</span>
                  </div>
                {% endif %}

                {% if order_note %}
                  <div class="checkout__detail-text mb-2">
                    <span>Коментарий к заказу:</span>
                    <span>{{ order_note }}</span>
                  </div>
                {% endif %}
              {% else %}
                <div class="order__subtitle mb-1 mb-sm-2">
                  <h2>Адрес самовывоза</h2>
                </div>
                <a href="{% url 'address:pickup-address' %}" class="checkout__detail-text mb-2"><address>{{ order.store.primary_address }}</address></a>
              {% endif %}
            </div>
            <div class="checkout__datail">
              <div class="order__subtitle mb-1 mb-sm-2">
                <h2>Телефон для связи</h2>
              </div>
              <div class="mb-2 checkout__detail-text">
                <p>{{ request.user.username }}</p>
              </div>
            </div>
          {% endblock %}
          {% block payment_info %}
            <div class="order__subtitle mb-1 mb-sm-2">
              <h2>Оплата</h2>
            </div>
            <div class="checkout__detail-text mr-2">
              <span>Способ оплаты:</span>
              <span>
                {% if payment_method == 'CASH' %}
                  Наличные
                {% elif payment_method == 'SBP' %}
                  СБП (Система быстрых платежей)
                {% elif payment_method == 'ONLINECARD' %}
                  Картой Онлайн
                {% elif payment_method == 'ELECTRON' %}
                  Картой в магазине
                {% else %}
                  Неизвестный способ оплаты
                {% endif %}
              </span>
            </div>
          {% endblock %}
        </div>
      </div>
      <div class="order__info ml-md-4">
        <div class="order__info-wrapper pt-4">
          <p class="order__title d-none d-md-block mb-2">Ваш заказ</p>
          <div class="order__subtitle d-md-none mb-1 mb-sm-2">
            <h2>Ваш заказ</h2>
          </div>
          <div class="order__subtitle mb-1 mb-sm-1 d-none d-md-block">
            <h2>Состав заказа</h2>
          </div>
          {% block order_contents %}
            <div class="order-checkout__items">
              {% for line in submission.basket.all_lines %}
                {% purchase_info_for_line request line as session %}
                <span>{{ line.get_full_name }} - {{ line.quantity }} {{ line.product.product_class.measure_name }}</span><br />
              {% endfor %}
            </div>
          {% endblock %}
          <div id="checkout_totals">
            {% include 'oscar/checkout/checkout_totals.html' with order_total=submission.order_total %}
          </div>
          <a href="#" class="button fill-width button--main justify-center shrink mt-3">Связаться с поддержкой</a>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block SVG %}
  <svg style="display: none">
    <symbol id="svg-order-cancel" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path fill="#b24040" d="M23,12A11,11,0,0,1,1,12a10.827,10.827,0,0,1,.29-2.5,11,11,0,0,1,21.42,0A10.827,10.827,0,0,1,23,12Z" />
      <ellipse fill="#ce5959" cx="12" cy="9.5" rx="10.71" ry="8.5" />
      <path fill="#6c2e7c" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm0,22A10,10,0,1,1,22,12,10.011,10.011,0,0,1,12,22Z" />
      <path fill="#6c2e7c" d="M16.707,7.293a1,1,0,0,0-1.414,0L12,10.586,8.707,7.293A1,1,0,1,0,7.293,8.707L10.586,12,7.293,15.293a1,1,0,1,0,1.414,1.414L12,13.414l3.293,3.293a1,1,0,0,0,1.414-1.414L13.414,12l3.293-3.293A1,1,0,0,0,16.707,7.293Z" />
    </symbol>
  </svg>
{% endblock %}

{% block templatescripts %}
  {{ block.super }}
  action_back = function(){window.location.href="{{ homepage_url }}"};
{% endblock %}
